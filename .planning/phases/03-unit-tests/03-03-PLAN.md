---
phase: 03-unit-tests
plan: 03
type: execute
depends_on: ["03-01"]
files_modified: [tests/commands/workflows.test.ts]
---

<objective>
Add unit tests for workflow command handlers.

Purpose: Ensure command handlers correctly parse options, call client methods, and format output. Mock client and output utilities.
Output: Test coverage for all 7 workflow commands.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/TESTING.md
@.planning/phases/03-unit-tests/03-01-SUMMARY.md
@src/commands/workflows.ts
@src/utils/client.ts
@src/utils/output.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tests for read commands (list, get)</name>
  <files>tests/commands/workflows.test.ts</files>
  <action>
Create tests/commands/workflows.test.ts with test suites for list and get commands:

1. Mock setup:
   - Mock ../src/utils/client.js module (createClient returns mock client)
   - Mock ../src/utils/output.js module (formatOutput returns string)
   - Mock console.log to capture output
   - Mock node:fs/promises and node:readline/promises (for later tests)

2. workflows list tests:
   - Creates client and calls listWorkflows with options
   - Passes --active option → listWorkflows({ active: true })
   - Passes --inactive option → listWorkflows({ active: false })
   - Passes --limit option → listWorkflows({ limit: number })
   - Passes --tags option → listWorkflows({ tags: string })
   - Uses 'table' format by default
   - Uses 'json' format with --json flag
   - Outputs formatOutput result to console.log

3. workflows get tests:
   - Creates client and calls getWorkflow with ID argument
   - Uses 'detail' format by default
   - Uses 'json' format with --json flag
   - Outputs formatOutput result to console.log

Use Commander's parseAsync to invoke commands programmatically:
```typescript
import { Command } from 'commander';
import { registerWorkflowCommands } from '../src/commands/workflows.js';

const program = new Command();
program.option('--host <host>');
program.option('--api-key <key>');
registerWorkflowCommands(program);
await program.parseAsync(['node', 'test', 'workflows', 'list', '--limit', '10']);
```
  </action>
  <verify>npm run test -- tests/commands/workflows.test.ts passes list and get command tests</verify>
  <done>Read command tests verify option parsing and client method calls</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for mutation commands (create, update, delete, activate, deactivate)</name>
  <files>tests/commands/workflows.test.ts</files>
  <action>
Add test suites for mutation commands to tests/commands/workflows.test.ts:

1. workflows create tests:
   - Mock readFile to return valid JSON workflow
   - Calls createWorkflow with parsed JSON data
   - Throws error for file not found (ENOENT)
   - Throws error for invalid JSON
   - Uses 'detail' format by default, 'json' with --json

2. workflows update tests:
   - Mock readFile to return valid JSON workflow
   - Calls updateWorkflow with ID argument and parsed JSON data
   - Throws error for file not found
   - Throws error for invalid JSON
   - Uses 'detail' format by default, 'json' with --json

3. workflows delete tests:
   - Mock readline createInterface and question
   - With --force: calls deleteWorkflow without prompt
   - Without --force: prompts user, 'y' confirms deletion
   - Without --force: prompts user, 'n' aborts
   - Outputs deletion confirmation message or JSON

4. workflows activate tests:
   - Calls activateWorkflow with ID argument
   - Uses 'detail' format by default, 'json' with --json

5. workflows deactivate tests:
   - Calls deactivateWorkflow with ID argument
   - Uses 'detail' format by default, 'json' with --json

Handle Commander exit behavior: wrap parseAsync in try/catch for expected exits.
  </action>
  <verify>npm run test -- tests/commands/workflows.test.ts passes all mutation command tests</verify>
  <done>Mutation command tests verify file reading, prompts, and client method calls</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] tests/commands/workflows.test.ts exists
- [ ] All 7 commands have tests (list, get, create, update, delete, activate, deactivate)
- [ ] File operations mocked for create/update
- [ ] Readline mocked for delete confirmation
- [ ] npm run test passes all tests
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- All workflow commands tested
- No TypeScript errors
- Phase 03 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-unit-tests/03-03-SUMMARY.md`
</output>
